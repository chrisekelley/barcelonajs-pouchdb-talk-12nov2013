<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>Using PouchDB for </title><link rel="stylesheet" type="text/css" href="bower_components/prism/themes/prism-tomorrow.css"><link rel="stylesheet" type="text/css" href="styles/main.css"></head><body><article><section><h2>Using PouchDB for PhoneGap/Cordova apps</h2><p>Chris Kelley</p>@chrisekelley</section><section><h2>Under Construction</h2><p>3/11/2013: I've created a few slides; however, there are more to come.</p><p>I will be updating these slides up to the date of my presentation on 12 November.</p><p>I'm designing this with bespoke.js.</p></section><section><h3>UBridge: SMS -> Couch on Android in Uganda</h3><img src="images/olutindoFlier.jpg"></section><section><h2>UBridge</h2><img src="images/olutindoAppHome.png" width="240" height="400" id="olutindoAppHome"></section><section><h2>Sustainability</h2><p>Reduce monthly data costs</p></section><section><h2 class="bullet">Hosting</h2><ul><li>Iriscouch - CORS support</li><li>Cloudant - BYO reverse proxy</li><li>Urban Airship - Notifications</li></ul></section><section><h2 class="bullet">Using</h2><ul><li>Apache CouchDB</li><li>PouchDB</li><li>Phonegap/Cordova 3.x</li><li>Backbone.js</li><li>Backbone-pouch.js</li><li>Coconut</li></ul></section><section><h2>Why PouchDB?</h2></section><section><h2>hood.ie!</h2></section><section><h2>Development Approach</h2><h3 class="bullet">2 projects</h3><ul><li>Web app</li><li>Android app</li></ul></section><section><h2>Building the Android app</h2><p>build.sh</p><code class="language-javascript"><pre>grunt cordova-build
adb uninstall org.rti.olutindo_app
adb install -r platforms/android/bin/Olutindo-debug.apk</pre></code></section><section><h2>Transitioning TouchDB to PouchDB</h2></section><section><h2>Converting CouchDB Views</h2><p>Created pouchdb_views.js and named each query:</p><code class="language-javascript"><pre>var bySearchKeywords = function(doc) {
  if(doc.phone) {
    emit(doc.phone, doc);
  }
}
</pre></code></section><section><h2>PouchDB Query Example</h2><hr><code class="language-javascript"><pre>searchResults.fetch(
  {fetch: 'query',
    options: {
        query: {
            fun:bySearchKeywords,
            key:searchTerm
        }
    },
    success: function(collection, response, options) {
        FORMY.Incidents = searchResults;
        var page = new Page();
        var Home = new HomeView(
            {model: page, el: $(&quot;#homePageView&quot;)});
    }}
);
</pre></code></section><section><h2>Connector<h3 class="bullet">backbone-pouch.js</h3><p>http://jo.github.io/backbone-pouch/</p></h2></section><section><h2>Development Issues</h2><h3 class="bullet">Need to handle CORS:</h3><ul><li>Cordova fine</li><li>WebDev not</li></ul><code class="language-javascript"><pre>var remoteCouch = &quot;http://localhost:3000/troubletickets/&quot;
+ subdomain + &quot;/&quot; + credentials;
if (navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry|IEMobile)/)) {
  remoteCouch = &quot;https://&quot; + credentials + &quot;@&quot; + subdomain
  + &quot;.cloudant.com/troubletickets/&quot;;
}</pre></code></section><section><h2>CORS solution:</h2><p>Using express + request to reverse proxy replication</p><p>app.js:</p><code class="language-javascript"><pre>var forward = require('./forward.js');
//typical static express config
app.use(express.static(__dirname + '../../www'));
var target_url = &quot;cloudant.com/troubletickets&quot;
app.use(forward(/\/troubletickets\/(.*)/, target_url));</pre></code></section><section><h2>CORS</h2><p>Using express + request to reverse proxy replication</p><p>forward.js:</p><code class="language-javascript"><pre>if(req.url.match(pattern)){
  var db_path = req.url.match(pattern)[1], parts = db_path.split(&quot;/&quot;);
  var subdomain = parts[0], credentials = parts[1];
  var query = parts[2];
  var db_url = &quot;https://&quot; + credentials + &quot;@&quot; + subdomain
   + &quot;.&quot; + host + &quot;/&quot; + query
  req.pipe(request[req.method.toLowerCase()](db_url)).pipe(res);
}else{
  next();
}</pre></code></section><section><h2>Notifications</h2><p>Urban Airship</p><p>Lower data costs: switch from continuous replication by using notifications</p></section><section><h2>Using Cordova</h2><ul><li>Plugins are cool!</li><li>Do enough plugins support Cordova 3.0?</li></ul></section><section><h2>Plugins i'm using</h2><ul><li>Version</li><li>WebIntent</li><li>Urban Airship PushNotification</li><li>file-transfer</li><li>SMS</li><li>Prefs</li></ul></section><section><h2>Adding a plugin</h2><code class="language-javascript"><pre>cordova plugin add https://github.com/urbanairship/phonegap-ua-push.git</pre></code></section><section><h2>Thanks!</h2><p>Under Construction</p><p>More work todo!</p><p>Thanks for bespoke.js:</p><a href="http://twitter.com/markdalgleish">@markdalgleish</a></section></article><script src="bower_components/bespoke.js/dist/bespoke.min.js"></script><script src="bower_components/bespoke-bullets/dist/bespoke-bullets.min.js"></script><script src="bower_components/bespoke-scale/dist/bespoke-scale.min.js"></script><script src="bower_components/bespoke-hash/dist/bespoke-hash.min.js"></script><script src="bower_components/bespoke-progress/dist/bespoke-progress.min.js"></script><script src="bower_components/bespoke-state/dist/bespoke-state.min.js"></script><script src="bower_components/prism/prism.js"></script><script src="scripts/main.js"></script></body></html>